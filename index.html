<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>FIT3179 A2 â€” AFL Membership Geography (2024)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Barlow:wght@400;500;600;700&family=Oswald:wght@500;600&display=swap"
    rel="stylesheet"
  />
  <style>
    :root {
      color-scheme: light;
      font-size: 18px;
      --page-max-width: 1080px;
      --page-padding: clamp(1.5rem, 4vw, 3rem);
      --text-colour: #1c1a16;
      --muted-colour: #4b463c;
      --accent-colour: #c1121f;
      --hover-colour: #2f7d3f;
      --background-colour: #f7f1e3;
    }
    body {
      margin: 0;
      font-family: "Barlow", "Segoe UI", "Helvetica Neue", Arial, sans-serif;
      font-weight: 400;
      line-height: 1.7;
      color: var(--text-colour);
      background: var(--background-colour);
      text-rendering: optimizeLegibility;
      -webkit-font-smoothing: antialiased;
    }
    .page {
      max-width: var(--page-max-width);
      margin: 0 auto;
      padding: var(--page-padding);
      background: #fff;
      box-shadow: 0 18px 50px rgba(21, 36, 56, 0.08);
      border-radius: 18px;
    }
    header {
      max-width: 68ch;
      margin-bottom: 2.5rem;
    }
    h1 {
      margin: 0 0 0.5rem;
      font-family: "Oswald", "Barlow", "Segoe UI", sans-serif;
      font-size: clamp(2.4rem, 5vw, 3.2rem);
      font-weight: 600;
      letter-spacing: 0.045em;
      text-transform: uppercase;
      color: #0b234a;
    }
    h2 {
      margin: 2.8rem 0 1rem;
      font-family: "Oswald", "Barlow", "Segoe UI", sans-serif;
      font-size: clamp(1.35rem, 3.1vw, 1.85rem);
      font-weight: 500;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: #102a56;
    }
    p,
    li {
      max-width: 70ch;
      font-size: 1rem;
      letter-spacing: 0.01em;
    }
    p {
      margin: 0.75rem 0 0;
      color: var(--muted-colour);
    }
    .annotation {
      margin-top: 0.85rem;
      font-weight: 500;
      color: var(--text-colour);
    }
    header p:first-of-type {
      margin-top: 0.5rem;
      font-size: 1.05rem;
      color: var(--text-colour);
      font-weight: 500;
    }
    .vis {
      margin: 1.5rem 0;
    }
    .row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: clamp(1.5rem, 3vw, 2.5rem);
      align-items: start;
    }
    section {
      max-width: 70ch;
      margin-top: 2rem;
    }
    ul {
      padding-left: 1.2rem;
      margin: 1rem 0 0;
      display: grid;
      gap: 0.65rem;
    }
    li {
      color: var(--muted-colour);
      line-height: 1.65;
    }
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
    button {
      font-family: "Oswald", "Barlow", sans-serif;
      font-size: 0.95rem;
      letter-spacing: 0.08em;
      padding: 0.65rem 1.15rem;
      border-radius: 999px;
      border: 2px solid var(--accent-colour);
      background: var(--accent-colour);
      color: #fffaf5;
      cursor: pointer;
      text-transform: uppercase;
      font-weight: 500;
      transition: background 160ms ease, color 160ms ease, box-shadow 160ms ease, border-color 160ms ease;
      box-shadow: 0 12px 24px rgba(193, 18, 31, 0.25);
    }
    button:hover,
    button:focus-visible {
      background: var(--hover-colour);
      border-color: var(--hover-colour);
      box-shadow: 0 10px 28px rgba(47, 125, 63, 0.28);
      color: #ffffff;
    }
    button:focus-visible {
      outline: 3px solid rgba(47, 125, 63, 0.45);
      outline-offset: 3px;
    }
    footer {
      margin-top: 3rem;
      font-size: 0.95rem;
      color: var(--muted-colour);
      letter-spacing: 0.02em;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>
<body>
  <div class="page">
    <header>
      <h1>AFL Club Memberships (2024)</h1>
      <p>Mapping where supporters congregate around each club. Membership scale drives the circle sizes, with linked charts ranking clubs and totalling each state.</p>
      <p id="map-alt" class="sr-only">Interactive dashboard showing an Equal Earth map of AFL club home grounds sized by 2024 memberships, a leaderboard of club totals, and a state-level membership summary. Hover highlights clubs and states; clicking filters selections, with a reset button available.</p>
    </header>

    <main>
      <div id="vis-map" class="vis" aria-describedby="map-alt"></div>
      <div class="row">
        <div>
          <h2>Club leaderboard</h2>
          <div id="vis-leaderboard" class="vis"></div>
        </div>
        <div>
          <h2>State share of members</h2>
          <div id="vis-state" class="vis"></div>
        </div>
      </div>
      <section>
        <h2>Which states punch above their weight?</h2>
        <div id="vis-per-capita" class="vis"></div>
        <p class="annotation">
          Victoria still towers over the league once population is considered, but South Australia and Western Australia
          reveal surprisingly dense supporter bases, each drawing more than fifty members per thousand residents. In
          contrast, the New South Wales and Queensland clubs lag because their memberships stay small relative to the
          millions living in those states.
        </p>
      </section>
      <button id="reset-filters" type="button">Reset selections</button>

      <section>
        <h2>What stands out?</h2>
        <ul>
          <li>Collingwood and Carlton eclipse the competition, breaking the 100k member mark and anchoring Victoria&rsquo;s dominance.</li>
          <li>West Coast remains the west coast powerhouse despite a smaller state population, while Sydney&rsquo;s clubs trail their Victorian peers.</li>
          <li>Filtering reveals how interstate clubs (WA, SA, NSW, QLD) stack up when isolated from Victoria&rsquo;s deep supporter bases.</li>
        </ul>
      </section>
    </main>

    <footer>
      <strong>Notes:</strong> Equal Earth projection using WGS84 ground coordinates. Membership data: official AFL 2024 totals.
    </footer>
  </div>

  <script>
    const sharedParams = [
      { name: "hoverClub", value: null },
      { name: "hoverState", value: null },
      { name: "selectedClubs", value: [] },
      { name: "selectedStates", value: [] }
    ];

    function withSharedParams(spec) {
      return { ...spec, params: [...sharedParams.map(p => ({ ...p }))] };
    }

    function dataBasePath() {
      const { pathname, protocol, host } = window.location;
      const segments = pathname.split("/").filter(Boolean);

      if (segments.length && segments[segments.length - 1].includes(".")) {
        segments.pop();
      }

      const srcIndex = segments.lastIndexOf("src");
      if (srcIndex !== -1) {
        segments.splice(srcIndex);
      }

      const joined = segments.join("/");
      const basePath = joined ? `/${joined}/` : "/";
      const prefix = protocol === "file:" ? "file://" : `${protocol}//${host}`;

      return `${prefix}${basePath}data/`;
    }

    function resolveDataUrl(fileName) {
      return `${dataBasePath()}${fileName}`;
    }

    const dataUrl = resolveDataUrl("afl_clubs_2024_geo.csv");
    const populationUrl = resolveDataUrl("pop_by_state.csv");
    const australiaTopoUrl = resolveDataUrl("world-110m.json");

    const melbourneBounds = {
      lonMin: 144.2,
      lonMax: 145.4,
      latMin: -38.4,
      latMax: -37.45
    };

    const melbourneCenter = [
      (melbourneBounds.lonMin + melbourneBounds.lonMax) / 2,
      (melbourneBounds.latMin + melbourneBounds.latMax) / 2
    ];

    const melbourneExtentFeature = {
      type: "Feature",
      properties: { name: "Melbourne-Geelong extent" },
      geometry: {
        type: "Polygon",
        coordinates: [[
          [melbourneBounds.lonMin, melbourneBounds.latMin],
          [melbourneBounds.lonMax, melbourneBounds.latMin],
          [melbourneBounds.lonMax, melbourneBounds.latMax],
          [melbourneBounds.lonMin, melbourneBounds.latMax],
          [melbourneBounds.lonMin, melbourneBounds.latMin]
        ]]
      }
    };

    const stateColours = {
      VIC: "#c1121f",
      WA: "#2f7d3f",
      SA: "#f2a541",
      NSW: "#234f72",
      QLD: "#7b1d5a"
    };
    const stateColourDomain = Object.keys(stateColours);
    const stateColourRange = stateColourDomain.map(state => stateColours[state]);

    const mapSpec = withSharedParams({
      $schema: "https://vega.github.io/schema/vega-lite/v5.json",
      width: 900,
      height: 520,
      data: { url: dataUrl },
      layer: [
        {
          projection: {
            type: "equalEarth",
            center: [133.7751, -25.2744],
            scale: 950
          },
          layer: [
            {
              data: {
                url: australiaTopoUrl,
                format: { type: "topojson", feature: "land" }
              },
              mark: { type: "geoshape", fill: "#dfe7d2", stroke: "#99a38e", strokeWidth: 1.2, clip: true }
            },
            {
              data: { graticule: true },
              mark: { type: "geoshape", stroke: "#bec7ba", strokeWidth: 0.5, fill: "transparent", clip: true }
            },
            {
              transform: [
                { filter: "selectedClubs.length == 0 || indexof(selectedClubs, datum.club) >= 0" },
                { filter: "selectedStates.length == 0 || indexof(selectedStates, datum.state) >= 0" }
              ],
              mark: { type: "circle", opacity: 0.9, strokeWidth: 1.5 },
              encoding: {
                longitude: { field: "lon", type: "quantitative" },
                latitude: { field: "lat", type: "quantitative" },
                size: {
                  field: "membership_2024",
                  type: "quantitative",
                  title: "Members (2024)",
                  scale: { range: [200, 3500] }
                },
                color: {
                  field: "state",
                  type: "nominal",
                  legend: { title: "State" },
                  scale: { domain: stateColourDomain, range: stateColourRange }
                },
                opacity: {
                  condition: [
                    { test: "hoverClub != null && datum.club == hoverClub", value: 1 },
                    { test: "hoverClub == null && hoverState != null && datum.state == hoverState", value: 0.95 },
                    { test: "indexof(selectedClubs, datum.club) >= 0", value: 1 },
                    { test: "selectedClubs.length == 0 && selectedStates.length > 0 && indexof(selectedStates, datum.state) >= 0", value: 0.95 }
                  ],
                  value: 0.45
                },
                stroke: {
                  condition: {
                    test: "indexof(selectedClubs, datum.club) >= 0",
                    value: "#c1121f"
                  },
                  value: "#f7f1e3"
                },
                tooltip: [
                  { field: "club", title: "Club" },
                  { field: "ground", title: "Home ground" },
                  { field: "membership_2024", title: "Members (2024)", format: "," },
                  { field: "state", title: "State" }
                ]
              }
            },
            {
              transform: [
                { window: [{ op: "rank", as: "rank_membership" }], sort: [{ field: "membership_2024", order: "descending" }] },
                { filter: "datum.rank_membership <= 3" }
              ],
              mark: { type: "text", dy: -18, fontWeight: "bold", fontSize: 12, fill: "#111", stroke: "white", strokeWidth: 3, strokeOpacity: 0.8 },
              encoding: {
                longitude: { field: "lon", type: "quantitative" },
                latitude: { field: "lat", type: "quantitative" },
                text: {
                  signal: "datum.rank_membership + '. ' + datum.club + ' (' + format(datum.membership_2024, ',') + ')'"
                }
              }
            },
            {
              data: { values: [melbourneExtentFeature] },
              mark: { type: "geoshape", fill: null, stroke: "#c1121f", strokeDash: [6, 4], strokeWidth: 2, clip: true }
            }
          ]
        },
        {
          view: { stroke: "none" },
          projection: {
            type: "mercator",
            center: melbourneCenter,
            scale: 6500,
            translate: [190, 180],
            clipExtent: [[40, 40], [340, 320]]
          },
          layer: [
            {
              data: {
                url: australiaTopoUrl,
                format: { type: "topojson", feature: "land" }
              },
              mark: { type: "geoshape", fill: "#dfe7d2", stroke: "#99a38e", strokeWidth: 1 }
            },
            {
              data: { values: [melbourneExtentFeature] },
              mark: { type: "geoshape", fill: null, stroke: "#c1121f", strokeWidth: 2 }
            },
            {
              data: { values: [{}] },
              mark: {
                type: "text",
                fontSize: 14,
                fontWeight: "bold",
                fill: "#102a56",
                baseline: "top"
              },
              encoding: {
                x: { value: 190 },
                y: { value: 52 },
                text: { value: "Melbourne & Geelong clubs" }
              }
            },
            {
              transform: [
                { filter: `datum.lon >= ${melbourneBounds.lonMin} && datum.lon <= ${melbourneBounds.lonMax}` },
                { filter: `datum.lat >= ${melbourneBounds.latMin} && datum.lat <= ${melbourneBounds.latMax}` },
                { filter: "selectedClubs.length == 0 || indexof(selectedClubs, datum.club) >= 0" },
                { filter: "selectedStates.length == 0 || indexof(selectedStates, datum.state) >= 0" }
              ],
              mark: { type: "circle", opacity: 0.95, strokeWidth: 1.5 },
              encoding: {
                longitude: { field: "lon", type: "quantitative" },
                latitude: { field: "lat", type: "quantitative" },
                size: {
                  field: "membership_2024",
                  type: "quantitative",
                  scale: { range: [200, 3500] }
                },
                color: {
                  field: "state",
                  type: "nominal",
                  legend: null,
                  scale: { domain: stateColourDomain, range: stateColourRange }
                },
                opacity: {
                  condition: [
                    { test: "hoverClub != null && datum.club == hoverClub", value: 1 },
                    { test: "hoverClub == null && hoverState != null && datum.state == hoverState", value: 1 },
                    { test: "indexof(selectedClubs, datum.club) >= 0", value: 1 },
                    { test: "selectedClubs.length == 0 && selectedStates.length > 0 && indexof(selectedStates, datum.state) >= 0", value: 1 }
                  ],
                  value: 0.45
                },
                stroke: {
                  condition: {
                    test: "indexof(selectedClubs, datum.club) >= 0",
                    value: "#c1121f"
                  },
                  value: "#f7f1e3"
                },
                tooltip: [
                  { field: "club", title: "Club" },
                  { field: "ground", title: "Home ground" },
                  { field: "membership_2024", title: "Members (2024)", format: "," },
                  { field: "state", title: "State" }
                ]
              }
            }
          ]
        }
      ]
    });

    const leaderboardSpec = withSharedParams({
      $schema: "https://vega.github.io/schema/vega-lite/v5.json",
      width: 460,
      height: 520,
      data: { url: dataUrl },
      transform: [
        { filter: "selectedClubs.length == 0 || indexof(selectedClubs, datum.club) >= 0" },
        { filter: "selectedStates.length == 0 || indexof(selectedStates, datum.state) >= 0" },
        { aggregate: [{ op: "max", field: "membership_2024", as: "membership_2024" }], groupby: ["club", "state"] },
        { window: [{ op: "rank", as: "rank_membership" }], sort: [{ field: "membership_2024", order: "descending" }] }
      ],
      layer: [
        {
          mark: { type: "bar", cornerRadiusEnd: 4 },
          encoding: {
            y: { field: "club", type: "nominal", sort: "-x", title: null },
            x: {
              field: "membership_2024",
              type: "quantitative",
              title: "Members (2024)",
              axis: { format: "," }
            },
            color: {
              field: "state",
              type: "nominal",
              legend: { title: "State" },
              scale: { domain: stateColourDomain, range: stateColourRange }
            },
            opacity: {
              condition: [
                { test: "hoverClub != null && datum.club == hoverClub", value: 1 },
                { test: "hoverClub == null && hoverState != null && datum.state == hoverState", value: 0.95 },
                { test: "indexof(selectedClubs, datum.club) >= 0", value: 1 },
                { test: "selectedClubs.length == 0 && selectedStates.length > 0 && indexof(selectedStates, datum.state) >= 0", value: 0.95 }
              ],
              value: 0.5
            },
            tooltip: [
              { field: "club", title: "Club" },
              { field: "membership_2024", title: "Members (2024)", format: "," },
              { field: "state", title: "State" }
            ]
          }
        },
        {
          transform: [{ filter: "datum.rank_membership <= 3" }],
          mark: { type: "text", align: "left", dx: 6, fontWeight: "bold", fill: "#111" },
          encoding: {
            y: { field: "club", type: "nominal", sort: "-x" },
            x: { field: "membership_2024", type: "quantitative" },
            text: {
              signal: "'Top ' + datum.rank_membership"
            }
          }
        },
        {
          transform: [
            { aggregate: [{ op: "median", field: "membership_2024", as: "median_membership" }] }
          ],
          mark: { type: "rule", color: "#6f6f6f", strokeDash: [4, 4], strokeWidth: 2 },
          encoding: {
            x: { field: "median_membership", type: "quantitative" }
          }
        },
        {
          transform: [
            { aggregate: [{ op: "median", field: "membership_2024", as: "median_membership" }] }
          ],
          mark: { type: "text", dy: -8, dx: 4, align: "left", baseline: "bottom", fill: "#333", fontWeight: "bold" },
          encoding: {
            x: { field: "median_membership", type: "quantitative" },
            y: { value: -10 },
            text: { signal: "'Median: ' + format(datum.median_membership, ',')" }
          }
        }
      ]
    });

    const stateSpec = withSharedParams({
      $schema: "https://vega.github.io/schema/vega-lite/v5.json",
      width: 460,
      height: 520,
      data: { url: dataUrl },
      transform: [
        { filter: "selectedClubs.length == 0 || indexof(selectedClubs, datum.club) >= 0" },
        { filter: "selectedStates.length == 0 || indexof(selectedStates, datum.state) >= 0" },
        { aggregate: [{ op: "sum", field: "membership_2024", as: "total_membership" }], groupby: ["state"] },
        { window: [{ op: "rank", as: "rank_state" }], sort: [{ field: "total_membership", order: "descending" }] }
      ],
      layer: [
        {
          mark: { type: "bar", cornerRadiusEnd: 4 },
          encoding: {
            y: { field: "state", type: "nominal", sort: "-x", title: "State" },
            x: {
              field: "total_membership",
              type: "quantitative",
              title: "Total members (2024)",
              axis: { format: "," }
            },
            color: {
              field: "state",
              type: "nominal",
              legend: null,
              scale: { domain: stateColourDomain, range: stateColourRange }
            },
            opacity: {
              condition: [
                { test: "hoverState != null && datum.state == hoverState", value: 1 },
                { test: "indexof(selectedStates, datum.state) >= 0", value: 1 }
              ],
              value: 0.5
            },
            tooltip: [
              { field: "state", title: "State" },
              { field: "total_membership", title: "Members (2024)", format: "," }
            ]
          }
        },
        {
          transform: [{ filter: "datum.rank_state == 1" }],
          mark: { type: "text", align: "left", dx: 6, fontWeight: "bold", fill: "#111" },
          encoding: {
            y: { field: "state", type: "nominal" },
            x: { field: "total_membership", type: "quantitative" },
            text: { value: "Largest share" }
          }
        }
      ]
    });

    const perCapitaSpec = withSharedParams({
      $schema: "https://vega.github.io/schema/vega-lite/v5.json",
      width: 900,
      height: 420,
      data: { url: dataUrl },
      transform: [
        { filter: "selectedClubs.length == 0 || indexof(selectedClubs, datum.club) >= 0" },
        { filter: "selectedStates.length == 0 || indexof(selectedStates, datum.state) >= 0" },
        { aggregate: [{ op: "sum", field: "membership_2024", as: "total_membership" }], groupby: ["state"] },
        {
          lookup: "state",
          from: {
            data: { url: populationUrl },
            key: "state_abbrev",
            fields: ["state_name", "erp_2025_03_31"]
          }
        },
        { calculate: "datum.total_membership / datum.erp_2025_03_31 * 1000", as: "members_per_1000" },
        { window: [{ op: "rank", as: "per_capita_rank" }], sort: [{ field: "members_per_1000", order: "descending" }] }
      ],
      layer: [
        {
          mark: { type: "point", filled: true, size: 220, strokeWidth: 1.6 },
          encoding: {
            y: { field: "state", type: "nominal", sort: "-x", title: "State" },
            x: {
              field: "members_per_1000",
              type: "quantitative",
              title: "Members per 1,000 residents",
              axis: { format: ".1f" }
            },
            color: { field: "state", type: "nominal", legend: null, scale: { domain: stateColourDomain, range: stateColourRange } },
            opacity: {
              condition: [
                { test: "hoverState != null && datum.state == hoverState", value: 1 },
                { test: "indexof(selectedStates, datum.state) >= 0", value: 1 }
              ],
              value: 0.45
            },
            stroke: {
              condition: {
                test: "hoverState != null && datum.state == hoverState || indexof(selectedStates, datum.state) >= 0",
                value: "#c1121f"
              },
              value: "#f7f1e3"
            },
            tooltip: [
              { field: "state_name", title: "State" },
              { field: "total_membership", title: "Members (2024)", format: "," },
              { field: "erp_2025_03_31", title: "Population (ERP Mar 2025)", format: "," },
              { field: "members_per_1000", title: "Members per 1,000", format: ".1f" }
            ]
          }
        }
      ]
    });

    const embedOptions = { actions: false }; // hide export menu

    const sharedState = {
      hoverClub: null,
      hoverState: null,
      selectedClubs: [],
      selectedStates: []
    };

    Promise.all([
      vegaEmbed("#vis-map", mapSpec, embedOptions),
      vegaEmbed("#vis-leaderboard", leaderboardSpec, embedOptions),
      vegaEmbed("#vis-state", stateSpec, embedOptions),
      vegaEmbed("#vis-per-capita", perCapitaSpec, embedOptions)
    ]).then(([mapRes, leaderboardRes, stateRes, perCapitaRes]) => {
      const mapView = mapRes.view;
      const leaderboardView = leaderboardRes.view;
      const stateView = stateRes.view;
      const perCapitaView = perCapitaRes.view;
      const allViews = [mapView, leaderboardView, stateView, perCapitaView];

      function syncViews() {
        allViews.forEach((view) => {
          view.signal("hoverClub", sharedState.hoverClub);
          view.signal("hoverState", sharedState.hoverState);
          view.signal("selectedClubs", sharedState.selectedClubs);
          view.signal("selectedStates", sharedState.selectedStates);
          view.runAsync();
        });
      }

      function toggleSelection(list, value) {
        const exists = list.includes(value);
        return exists ? list.filter((v) => v !== value) : [...list, value];
      }

      function handleClubHover(datum) {
        if (datum && datum.club) {
          sharedState.hoverClub = datum.club;
          sharedState.hoverState = datum.state || sharedState.hoverState;
          syncViews();
        }
      }

      function clearClubHover() {
        sharedState.hoverClub = null;
        if (sharedState.selectedStates.length === 0) {
          sharedState.hoverState = null;
        }
        syncViews();
      }

      function handleStateHover(datum) {
        if (datum && datum.state) {
          sharedState.hoverState = datum.state;
          syncViews();
        }
      }

      function clearStateHover() {
        sharedState.hoverState = null;
        syncViews();
      }

      function handleClubClick(datum) {
        if (datum && datum.club) {
          sharedState.selectedClubs = toggleSelection(sharedState.selectedClubs, datum.club);
          if (datum.state) {
            sharedState.hoverState = datum.state;
          }
          syncViews();
        }
      }

      function handleStateClick(datum) {
        if (datum && datum.state) {
          sharedState.selectedStates = toggleSelection(sharedState.selectedStates, datum.state);
          syncViews();
        }
      }

      mapView.addEventListener("pointerover", (event, item) => {
        if (item && item.datum) {
          handleClubHover(item.datum);
        }
      });

      mapView.addEventListener("pointerout", () => {
        clearClubHover();
      });

      mapView.addEventListener("click", (event, item) => {
        if (item && item.datum) {
          handleClubClick(item.datum);
        }
      });

      leaderboardView.addEventListener("pointerover", (event, item) => {
        if (item && item.datum && item.datum.club) {
          sharedState.hoverState = item.datum.state || null;
          handleClubHover(item.datum);
        }
      });

      leaderboardView.addEventListener("pointerout", () => {
        clearClubHover();
      });

      leaderboardView.addEventListener("click", (event, item) => {
        if (item && item.datum) {
          handleClubClick(item.datum);
        }
      });

      stateView.addEventListener("pointerover", (event, item) => {
        if (item && item.datum) {
          handleStateHover(item.datum);
        }
      });

      stateView.addEventListener("pointerout", () => {
        clearStateHover();
      });

      stateView.addEventListener("click", (event, item) => {
        if (item && item.datum) {
          handleStateClick(item.datum);
        }
      });

      perCapitaView.addEventListener("pointerover", (event, item) => {
        if (item && item.datum) {
          handleStateHover(item.datum);
        }
      });

      perCapitaView.addEventListener("pointerout", () => {
        clearStateHover();
      });

      perCapitaView.addEventListener("click", (event, item) => {
        if (item && item.datum) {
          handleStateClick(item.datum);
        }
      });

      document.getElementById("reset-filters").addEventListener("click", () => {
        sharedState.hoverClub = null;
        sharedState.hoverState = null;
        sharedState.selectedClubs = [];
        sharedState.selectedStates = [];
        syncViews();
      });

      syncViews();
    }).catch((error) => {
      console.error("Error embedding visualisations", error);
    });
  </script>
</body>
</html>
