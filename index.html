<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>FIT3179 A2 â€” AFL Membership Geography (2024)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Barlow:wght@400;500;600;700&family=Oswald:wght@500;600&display=swap"
    rel="stylesheet"
  />
  <style>
    :root {
      color-scheme: light;
      font-size: 18px;
      --page-max-width: 1080px;
      --page-padding: clamp(1.5rem, 4vw, 3rem);
      --text-colour: #1c1a16;
      --muted-colour: #4b463c;
      --accent-colour: #c1121f;
      --hover-colour: #2f7d3f;
      --background-colour: #f7f1e3;
    }
    body {
      margin: 0;
      font-family: "Barlow", "Segoe UI", "Helvetica Neue", Arial, sans-serif;
      font-weight: 400;
      line-height: 1.7;
      color: var(--text-colour);
      background: var(--background-colour);
      text-rendering: optimizeLegibility;
      -webkit-font-smoothing: antialiased;
    }
    .page {
      max-width: var(--page-max-width);
      margin: 0 auto;
      padding: var(--page-padding);
      background: #fff;
      box-shadow: 0 18px 50px rgba(21, 36, 56, 0.08);
      border-radius: 18px;
    }
    header {
      max-width: 68ch;
      margin-bottom: 2.5rem;
    }
    h1 {
      margin: 0 0 0.5rem;
      font-family: "Oswald", "Barlow", "Segoe UI", sans-serif;
      font-size: clamp(2.4rem, 5vw, 3.2rem);
      font-weight: 600;
      letter-spacing: 0.045em;
      text-transform: uppercase;
      color: #0b234a;
    }
    h2 {
      margin: 2.8rem 0 1rem;
      font-family: "Oswald", "Barlow", "Segoe UI", sans-serif;
      font-size: clamp(1.35rem, 3.1vw, 1.85rem);
      font-weight: 500;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: #102a56;
    }
    p,
    li {
      max-width: 70ch;
      font-size: 1rem;
      letter-spacing: 0.01em;
    }
    p {
      margin: 0.75rem 0 0;
      color: var(--muted-colour);
    }
    .annotation {
      margin-top: 0.85rem;
      font-weight: 500;
      color: var(--text-colour);
    }
    header p:first-of-type {
      margin-top: 0.5rem;
      font-size: 1.05rem;
      color: var(--text-colour);
      font-weight: 500;
    }
    .vis {
      margin: 1.5rem 0;
    }
    .row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: clamp(1.5rem, 3vw, 2.5rem);
      align-items: start;
    }
    section {
      max-width: 70ch;
      margin-top: 2rem;
    }
    ul {
      padding-left: 1.2rem;
      margin: 1rem 0 0;
      display: grid;
      gap: 0.65rem;
    }
    li {
      color: var(--muted-colour);
      line-height: 1.65;
    }
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
    button {
      font-family: "Oswald", "Barlow", sans-serif;
      font-size: 0.95rem;
      letter-spacing: 0.08em;
      padding: 0.65rem 1.15rem;
      border-radius: 999px;
      border: 2px solid var(--accent-colour);
      background: var(--accent-colour);
      color: #fffaf5;
      cursor: pointer;
      text-transform: uppercase;
      font-weight: 500;
      transition: background 160ms ease, color 160ms ease, box-shadow 160ms ease, border-color 160ms ease;
      box-shadow: 0 12px 24px rgba(193, 18, 31, 0.25);
    }
    button:hover,
    button:focus-visible {
      background: var(--hover-colour);
      border-color: var(--hover-colour);
      box-shadow: 0 10px 28px rgba(47, 125, 63, 0.28);
      color: #ffffff;
    }
    button:focus-visible {
      outline: 3px solid rgba(47, 125, 63, 0.45);
      outline-offset: 3px;
    }
    footer {
      margin-top: 3rem;
      font-size: 0.95rem;
      color: var(--muted-colour);
      letter-spacing: 0.02em;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>
<body>
  <div class="page">
    <header>
      <h1>AFL Club Memberships (2024)</h1>
      <p>Mapping where supporters congregate around each club. Membership scale drives the circle sizes, with linked charts ranking clubs and totalling each state.</p>
      <p id="map-alt" class="sr-only">Interactive dashboard showing an Equal Earth map of AFL club home grounds sized by 2024 memberships, a leaderboard of club totals, and a state-level membership summary. Hover highlights clubs and states; clicking filters selections, with a reset button available.</p>
    </header>

    <main>
      <div id="vis-map" class="vis" aria-describedby="map-alt"></div>
      <div class="row">
        <div>
          <h2>Club leaderboard</h2>
          <div id="vis-leaderboard" class="vis"></div>
        </div>
        <div>
          <h2>State share of members</h2>
          <div id="vis-state" class="vis"></div>
        </div>
      </div>
      <section>
        <h2>Which states punch above their weight?</h2>
        <div id="vis-per-capita" class="vis"></div>
        <p class="annotation">
          Victoria still towers over the league once population is considered, but South Australia and Western Australia
          reveal surprisingly dense supporter bases, each drawing more than fifty members per thousand residents. In
          contrast, the New South Wales and Queensland clubs lag because their memberships stay small relative to the
          millions living in those states.
        </p>
      </section>
      <button id="reset-filters" type="button">Reset selections</button>

      <section>
        <h2>What stands out?</h2>
        <ul>
          <li>Collingwood and Carlton eclipse the competition, breaking the 100k member mark and anchoring Victoria&rsquo;s dominance.</li>
          <li>West Coast remains the west coast powerhouse despite a smaller state population, while Sydney&rsquo;s clubs trail their Victorian peers.</li>
          <li>Filtering reveals how interstate clubs (WA, SA, NSW, QLD) stack up when isolated from Victoria&rsquo;s deep supporter bases.</li>
        </ul>
      </section>
    </main>

    <footer>
      <strong>Notes:</strong> Equal Earth projection using WGS84 ground coordinates. Membership data: official AFL 2024 totals.
    </footer>
  </div>

  <script>
    function dataBasePath() {
      const { pathname, protocol, host } = window.location;
      const segments = pathname.split("/").filter(Boolean);

      if (segments.length && segments[segments.length - 1].includes(".")) {
        segments.pop();
      }

      const srcIndex = segments.lastIndexOf("src");
      if (srcIndex !== -1) {
        segments.splice(srcIndex);
      }

      const joined = segments.join("/");
      const basePath = joined ? `/${joined}/` : "/";
      const prefix = protocol === "file:" ? "file://" : `${protocol}//${host}`;

      return `${prefix}${basePath}data/`;
    }

    function resolveDataUrl(fileName) {
      return `${dataBasePath()}${fileName}`;
    }

    function resolveSpecUrl(fileName) {
      return resolveDataUrl(`../specs/${fileName}`);
    }

    const embedOptions = { actions: false }; // hide export menu

    const sharedState = {
      hoverClub: null,
      hoverState: null,
      selectedClubs: [],
      selectedStates: []
    };

    Promise.all([
      vegaEmbed("#vis-map", resolveSpecUrl("map.json"), embedOptions),
      vegaEmbed("#vis-leaderboard", resolveSpecUrl("leaderboard.json"), embedOptions),
      vegaEmbed("#vis-state", resolveSpecUrl("state.json"), embedOptions),
      vegaEmbed("#vis-per-capita", resolveSpecUrl("per-capita.json"), embedOptions)
    ]).then(([mapRes, leaderboardRes, stateRes, perCapitaRes]) => {
      const mapView = mapRes.view;
      const leaderboardView = leaderboardRes.view;
      const stateView = stateRes.view;
      const perCapitaView = perCapitaRes.view;
      const allViews = [mapView, leaderboardView, stateView, perCapitaView];

      function syncViews() {
        allViews.forEach((view) => {
          view.signal("hoverClub", sharedState.hoverClub);
          view.signal("hoverState", sharedState.hoverState);
          view.signal("selectedClubs", sharedState.selectedClubs);
          view.signal("selectedStates", sharedState.selectedStates);
          view.runAsync();
        });
      }

      function toggleSelection(list, value) {
        const exists = list.includes(value);
        return exists ? list.filter((v) => v !== value) : [...list, value];
      }

      function handleClubHover(datum) {
        if (datum && datum.club) {
          sharedState.hoverClub = datum.club;
          sharedState.hoverState = datum.state || sharedState.hoverState;
          syncViews();
        }
      }

      function clearClubHover() {
        sharedState.hoverClub = null;
        if (sharedState.selectedStates.length === 0) {
          sharedState.hoverState = null;
        }
        syncViews();
      }

      function handleStateHover(datum) {
        if (datum && datum.state) {
          sharedState.hoverState = datum.state;
          syncViews();
        }
      }

      function clearStateHover() {
        sharedState.hoverState = null;
        syncViews();
      }

      function handleClubClick(datum) {
        if (datum && datum.club) {
          sharedState.selectedClubs = toggleSelection(sharedState.selectedClubs, datum.club);
          if (datum.state) {
            sharedState.hoverState = datum.state;
          }
          syncViews();
        }
      }

      function handleStateClick(datum) {
        if (datum && datum.state) {
          sharedState.selectedStates = toggleSelection(sharedState.selectedStates, datum.state);
          syncViews();
        }
      }

      mapView.addEventListener("pointerover", (event, item) => {
        if (item && item.datum) {
          handleClubHover(item.datum);
        }
      });

      mapView.addEventListener("pointerout", () => {
        clearClubHover();
      });

      mapView.addEventListener("click", (event, item) => {
        if (item && item.datum) {
          handleClubClick(item.datum);
        }
      });

      leaderboardView.addEventListener("pointerover", (event, item) => {
        if (item && item.datum && item.datum.club) {
          sharedState.hoverState = item.datum.state || null;
          handleClubHover(item.datum);
        }
      });

      leaderboardView.addEventListener("pointerout", () => {
        clearClubHover();
      });

      leaderboardView.addEventListener("click", (event, item) => {
        if (item && item.datum) {
          handleClubClick(item.datum);
        }
      });

      stateView.addEventListener("pointerover", (event, item) => {
        if (item && item.datum) {
          handleStateHover(item.datum);
        }
      });

      stateView.addEventListener("pointerout", () => {
        clearStateHover();
      });

      stateView.addEventListener("click", (event, item) => {
        if (item && item.datum) {
          handleStateClick(item.datum);
        }
      });

      perCapitaView.addEventListener("pointerover", (event, item) => {
        if (item && item.datum) {
          handleStateHover(item.datum);
        }
      });

      perCapitaView.addEventListener("pointerout", () => {
        clearStateHover();
      });

      perCapitaView.addEventListener("click", (event, item) => {
        if (item && item.datum) {
          handleStateClick(item.datum);
        }
      });

      document.getElementById("reset-filters").addEventListener("click", () => {
        sharedState.hoverClub = null;
        sharedState.hoverState = null;
        sharedState.selectedClubs = [];
        sharedState.selectedStates = [];
        syncViews();
      });

      syncViews();
    }).catch((error) => {
      console.error("Error embedding visualisations", error);
    });
  </script>
</body>
</html>
